{"id":"moon-game-studio-0jj","title":"Implement Mesh2d rectangle shape","description":"Extend Mesh2d to support Rectangle mesh generation in host + render2d.","notes":"Added Rectangle mesh creation and mesh2d example; build and moon check passed. Pending browser verification tracked in moon-game-studio-ukx.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T13:53:06.435815+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:02:21.213776+08:00","closed_at":"2026-01-21T14:02:21.213778+08:00"}
{"id":"moon-game-studio-0lf","title":"Implement pixel_grid_snap example","description":"Implement pixel_grid_snap example (simplified for current engine: snap sprite to pixel grid without render-to-texture). Confirm design divergence from Bevy; hook to runner + menu; update .private docs after browser verification.","notes":"Implemented bevy-aligned pixel_grid_snap with render targets, layers, and mesh; docs updated.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T12:42:28.506716+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:02:00.739875+08:00","closed_at":"2026-01-21T14:02:00.739877+08:00"}
{"id":"moon-game-studio-1bp","title":"Align user-change propagation with rapier (colliders/joints)","description":"Port rapier/pipeline/user_changes: handle rigid-body changes propagating to colliders/joints, add ModifiedColliders/ColliderChanges tracking, and update pipeline clear/propagate flow.","notes":"Implemented collider/joint user-change propagation: collider enable state + modified tracking, parent enable propagation, mass-prop change marking, pipeline handling; updated specs/mbti; moon info/fmt/check + tests (dynamics, pipeline) pass.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T16:50:44.292914+08:00","created_by":"Milky2018","updated_at":"2026-01-22T17:38:08.513893+08:00","closed_at":"2026-01-22T17:38:08.513896+08:00"}
{"id":"moon-game-studio-1lk","title":"Fix WebGPU render target format mismatch","description":"Render target textures use rgba8unorm while pipeline uses swapchain format (bgra8unorm), causing pass/pipeline mismatch in mesh2d/pixel_grid_snap.","notes":"Use swapchain format for render targets in host.js to match pipeline attachment format.","status":"closed","priority":1,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T14:07:31.148669+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:07:38.727392+08:00","closed_at":"2026-01-21T14:07:38.727395+08:00"}
{"id":"moon-game-studio-38v","title":"Port remaining rapier dynamics components","description":"Continue aligning mgstudio_physics dynamics with rapier: add rigid_body_components fields (damping/forces/activation) and solver/integration pieces as needed.","notes":"Added rigid-body impulse APIs and mass-props setters with tests; ran moon fmt/info/check/test for dynamics.","status":"in_progress","priority":2,"issue_type":"task","assignee":"Milky2018","owner":"842376130@qq.com","created_at":"2026-01-22T13:13:27.722534+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:55:07.828832+08:00","comments":[{"id":11,"issue_id":"moon-game-studio-38v","author":"Milky2018","text":"Added internal RigidBodyIds (active_island_id/active_set_id/active_set_timestamp) and wired IslandManager traversal/indexing to read/update them; removed body_active_timestamps array. Re-ran moon fmt/info/check/test for dynamics.","created_at":"2026-01-22T06:56:10Z"}]}
{"id":"moon-game-studio-38v.1","title":"Align IslandManager sleep traversal with rapier","description":"Audit mgstudio-physics/dynamics/placeholders.mbt IslandManager vs rapier/src/dynamics/island_manager/* (sleep.rs, optimizer.rs). Bring traversal, contact graph handling, and sleep root state transitions to parity with rapier 2D semantics.","notes":"Blocked by collision-\u003edynamics import cycle; island manager cannot depend on collision without refactor. Keep ContactGraph until dependency split or shared core.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:36:24.244474+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:55:08.997397+08:00","dependencies":[{"issue_id":"moon-game-studio-38v.1","depends_on_id":"moon-game-studio-38v","type":"parent-child","created_at":"2026-01-22T19:36:24.245269+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-4bo","title":"Align RigidBodyType and handle API with rapier","description":"Add KinematicVelocityBased body type, handle raw parts helpers, and related builder/tests for mgstudio_physics dynamics.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T13:09:31.221828+08:00","created_by":"Milky2018","updated_at":"2026-01-22T13:12:34.777327+08:00","closed_at":"2026-01-22T13:12:34.777327+08:00","close_reason":"done"}
{"id":"moon-game-studio-4lk","title":"Migrate web runtime host to MoonBit WebGPU FFI","description":"Port mgstudio-runtime/web host runtime from JS to MoonBit, add WebGPU FFI subpackage, and wire loader to use MoonBit host.","status":"in_progress","priority":2,"issue_type":"task","assignee":"Milky2018","owner":"842376130@qq.com","created_at":"2026-01-21T18:31:32.932017+08:00","created_by":"Milky2018","updated_at":"2026-01-21T18:31:37.320649+08:00","comments":[{"id":1,"issue_id":"moon-game-studio-4lk","author":"Milky2018","text":"Fix wasm:js-string imports for use-js-builtin-string by providing length/charCodeAt/concat/fromCharCodeArray in web runtime.","created_at":"2026-01-22T02:40:45Z"},{"id":2,"issue_id":"moon-game-studio-4lk","author":"Milky2018","text":"Handle js-string fromCharCodeArray for array.get + array indexing + typed-array/ArrayBuffer fallback to fix wasm-gc string import runtime.","created_at":"2026-01-22T02:44:01Z"},{"id":3,"issue_id":"moon-game-studio-4lk","author":"Milky2018","text":"Root cause: fromCharCodeArray receives wasm GC arrayref; must use WebAssembly.String.fromCharCodeArray (or WebAssembly.Array.get) instead of treating it like JS array.","created_at":"2026-01-22T02:47:46Z"},{"id":4,"issue_id":"moon-game-studio-4lk","author":"Milky2018","text":"Switch wasm instantiation to JS String builtins (builtins: [\"js-string\"]) and remove manual wasm:js-string imports.","created_at":"2026-01-22T02:54:02Z"}]}
{"id":"moon-game-studio-526","title":"Implement mgstudio_physics collision/query/pipeline/control APIs and unskip tests","description":"Implement collision, query, pipeline, and control APIs (replace #declaration_only) and unskip related tests.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T19:45:43.386227+08:00","created_by":"Milky2018","updated_at":"2026-01-22T09:06:51.638668+08:00","closed_at":"2026-01-22T09:06:51.638668+08:00","close_reason":"Closed","labels":["status:in_progress"]}
{"id":"moon-game-studio-526.1","title":"State change: status → in_progress","description":"Set status to in_progress","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-21T20:26:07.103912+08:00","created_by":"Milky2018","updated_at":"2026-01-21T20:26:07.103912+08:00","dependencies":[{"issue_id":"moon-game-studio-526.1","depends_on_id":"moon-game-studio-526","type":"parent-child","created_at":"2026-01-21T20:26:07.104548+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-66w","title":"Integrate joint wake/join queues in physics pipeline","description":"Add take_wake_up/to_join APIs for joint sets and consume them in PhysicsPipeline::step to wake bodies and join islands per rapier.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T10:55:32.411555+08:00","created_by":"Milky2018","updated_at":"2026-01-22T10:59:14.436761+08:00","closed_at":"2026-01-22T10:59:14.436761+08:00","close_reason":"done"}
{"id":"moon-game-studio-6b5","title":"Implement GizmoConfig + line style config","description":"Add Bevy-aligned GizmoConfig/GizmoLineConfig types and apply line width/style (solid/dotted/dashed) in web gizmo pipeline.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T12:53:13.545009+08:00","created_by":"Milky2018","updated_at":"2026-01-22T12:53:13.545009+08:00","labels":["status:done","status:in_progress"],"comments":[{"id":9,"issue_id":"moon-game-studio-6b5","author":"Milky2018","text":"Added GizmoConfig/GizmoLineConfig/GizmoLineStyle/GizmoLineJoint types + gizmo_config setters, applied config line width/style (solid/dotted/dashed) via host gizmo pipeline; host_gpu_draw_gizmo_line now carries width/style params. Line joints are stored in config but not yet applied in rendering (currently behaves like None).","created_at":"2026-01-22T05:01:43Z"}]}
{"id":"moon-game-studio-6b5.1","title":"State change: status → in_progress","description":"Set status to in_progress\n\nReason: Start implementing GizmoConfig + line style","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-22T12:53:20.336704+08:00","created_by":"Milky2018","updated_at":"2026-01-22T12:53:20.336704+08:00","dependencies":[{"issue_id":"moon-game-studio-6b5.1","depends_on_id":"moon-game-studio-6b5","type":"parent-child","created_at":"2026-01-22T12:53:20.337633+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-6b5.2","title":"State change: status → done","description":"Changed status from in_progress to done\n\nReason: GizmoConfig + line style implemented; line joints not yet rendered (default None).","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-22T13:01:52.396558+08:00","created_by":"Milky2018","updated_at":"2026-01-22T13:01:52.396558+08:00","dependencies":[{"issue_id":"moon-game-studio-6b5.2","depends_on_id":"moon-game-studio-6b5","type":"parent-child","created_at":"2026-01-22T13:01:52.397213+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-6vh","title":"Implement Gizmos (Bevy-aligned) for 2D examples","description":"Provide Gizmos API compatible with bevy::gizmos used in 2d_viewport_to_world, including shape drawing, batching, and render2d integration.","notes":"Add design in .private/docs/engine and confirm before implementation.","status":"in_progress","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T11:08:01.278304+08:00","created_by":"Milky2018","updated_at":"2026-01-22T11:08:07.360284+08:00","labels":["status:done"],"comments":[{"id":5,"issue_id":"moon-game-studio-6vh","author":"Milky2018","text":"Drafted .private/docs/engine/GIZMO.md with Bevy-aligned 2D Gizmo API + pipeline plan; awaiting confirmation on global gizmos API and line width strategy.","created_at":"2026-01-22T03:13:21Z"},{"id":6,"issue_id":"moon-game-studio-6vh","author":"Milky2018","text":"Implemented Gizmos API + builder support (ellipses/arcs/rounded-rect/arrows/grid), added per-pass line rendering via WebGPU pipeline + gizmo shader, updated viewport_to_world to use Gizmos, and synced .private/docs/engine/GIZMO.md. Browser validation pending (expect circles/lines to render).","created_at":"2026-01-22T04:25:53Z"},{"id":8,"issue_id":"moon-game-studio-6vh","author":"Milky2018","text":"Implemented Bevy-aligned 2D Gizmos (lines/rect/circle/ellipse/arc/rounded-rect/arrow/axes/cross/grid/curve), SystemParam get, render2d integration, host draw API, and gizmo shader; moon check passes for mgstudio-engine + mgstudio-runtime/web/mbt. Browser validation still pending.","created_at":"2026-01-22T04:32:43Z"}]}
{"id":"moon-game-studio-6vh.1","title":"State change: status → done","description":"Set status to done\n\nReason: Gizmos implementation complete; browser validation pending.","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-22T12:32:50.9819+08:00","created_by":"Milky2018","updated_at":"2026-01-22T12:32:50.9819+08:00","dependencies":[{"issue_id":"moon-game-studio-6vh.1","depends_on_id":"moon-game-studio-6vh","type":"parent-child","created_at":"2026-01-22T12:32:50.98258+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-6w5","title":"Tidy mgstudio_physics core imports and deprecated string APIs","description":"Add missing core imports (math/strconv) in moon.pkg.json and replace deprecated string helpers in serialization code.","status":"open","priority":3,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T19:45:57.518731+08:00","created_by":"Milky2018","updated_at":"2026-01-21T19:46:38.90174+08:00","labels":["status:done","status:in_progress"]}
{"id":"moon-game-studio-6w5.2","title":"State change: status → done","description":"Changed status from in_progress to done","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-21T20:20:16.654313+08:00","created_by":"Milky2018","updated_at":"2026-01-21T20:20:16.654313+08:00","dependencies":[{"issue_id":"moon-game-studio-6w5.2","depends_on_id":"moon-game-studio-6w5","type":"parent-child","created_at":"2026-01-21T20:20:16.655076+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-88m","title":"Add WebGPU FFI subpackage (mgstudio-runtime/web/mbt/webgpu)","notes":"Added webgpu subpackage with minimal WebGPU FFI + constants and integrated into runtime (preferred format log).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-21T17:48:44.957639+08:00","updated_at":"2026-01-21T17:52:15.028272+08:00","closed_at":"2026-01-21T17:52:15.028275+08:00"}
{"id":"moon-game-studio-8zd","title":"Align island optimizer limits and boundary tests","description":"Add additional solver iteration tracking for islands and expand island merge/split tests.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T12:40:44.369788+08:00","created_by":"Milky2018","updated_at":"2026-01-22T12:53:30.794612+08:00","closed_at":"2026-01-22T12:53:30.794612+08:00","close_reason":"done"}
{"id":"moon-game-studio-b3r","title":"Implement render2d camera_system parity with Bevy (viewport + scale factor)","description":"Port Bevy camera_system behavior: maintain computed target info, scale factor, viewport clamp, logical viewport rect conversions, and update render2d_viewport_to_world/world_to_viewport to use logical coords. Align input cursor to logical coordinates and add window scale factor host API.","notes":"Implemented camera_system parity (target size + scale factor, viewport clamp/rescale), logical cursor coordinates, render2d conversions use logical viewport, render pass uses logical size, added host window scale factor API. Pending browser verification of 2d_viewport_to_world.","status":"in_progress","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T09:43:07.689921+08:00","created_by":"Milky2018","updated_at":"2026-01-22T09:58:09.916379+08:00"}
{"id":"moon-game-studio-bag","title":"Refine mgstudio-physics dynamics joints/islands/integration","description":"Implement IslandManager wake/merge behavior, expand ImpulseJointSet graph queries, and start next dynamics module (integration parameters or CCD) aligned with rapier.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T19:18:39.526686+08:00","created_by":"Milky2018","updated_at":"2026-01-21T20:56:38.859507+08:00","closed_at":"2026-01-21T20:56:38.859507+08:00","close_reason":"Closed","labels":["status:done"]}
{"id":"moon-game-studio-bag.1","title":"State change: status → in_progress","description":"Set status to in_progress\n\nReason: Starting dynamics joint/island/integration work","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-21T19:18:51.305142+08:00","created_by":"Milky2018","updated_at":"2026-01-21T19:18:51.305142+08:00","dependencies":[{"issue_id":"moon-game-studio-bag.1","depends_on_id":"moon-game-studio-bag","type":"parent-child","created_at":"2026-01-21T19:18:51.305871+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-bkg","title":"Implement L1 sprite_scale \u0026 sprite_flipping examples","description":"Add MoonBit examples for sprite_scale and sprite_flipping; hook to runner exports and web menu; ensure build passes.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T11:34:33.352226+08:00","created_by":"Milky2018","updated_at":"2026-01-21T11:34:41.072567+08:00","closed_at":"2026-01-21T11:34:41.072567+08:00","close_reason":"Closed"}
{"id":"moon-game-studio-dpi","title":"Verify L1 sprite_scale \u0026 sprite_flipping in browser","description":"Run web menu, verify sprite_scale and sprite_flipping render correctly in browser; then update  checkboxes once confirmed.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T11:34:18.257868+08:00","created_by":"Milky2018","updated_at":"2026-01-21T11:42:14.575825+08:00","closed_at":"2026-01-21T11:42:14.575825+08:00","close_reason":"Closed"}
{"id":"moon-game-studio-i0b","title":"Vendor upstream swash/cosmic-text and start MoonBit ports (mgstudio-swash, mgstudio-text)","description":"Clone upstream repos into repo root (ignored), create MoonBit modules mgstudio-swash and mgstudio-text to port swash/cosmic-text. Top priority for Text2d Bevy parity.","status":"in_progress","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T18:35:28.385416+08:00","created_by":"Milky2018","updated_at":"2026-01-22T18:35:38.920621+08:00","comments":[{"id":21,"issue_id":"moon-game-studio-i0b","author":"Milky2018","text":"Done: cloned upstream repos into ./cosmic-text and ./swash (both gitignored). Scaffolded MoonBit modules ./mgstudio-text and ./mgstudio-swash (module names Milky2018/mgstudio_text and Milky2018/mgstudio_swash due to MoonBit name rules). Next: start port by mapping upstream crate modules -\u003e MoonBit subpackages, begin with swash glyph raster (TTF parsing + outline + raster) and cosmic-text Buffer/layout/wrap.","created_at":"2026-01-22T10:40:38Z"},{"id":22,"issue_id":"moon-game-studio-i0b","author":"Milky2018","text":"Created port plan doc: .private/docs/text/PORTING_PLAN.md. Split work into mgstudio-swash (P0) then mgstudio-text (P1) while keeping Bevy pipeline structure.","created_at":"2026-01-22T10:43:51Z"},{"id":23,"issue_id":"moon-game-studio-i0b","author":"Milky2018","text":"Wired local module deps: mgstudio-text now depends on mgstudio-swash via moon.mod.json deps (path ../mgstudio-swash); verified with moon check.","created_at":"2026-01-22T11:01:12Z"},{"id":25,"issue_id":"moon-game-studio-i0b","author":"Milky2018","text":"Renamed module: mgstudio-text -\u003e mgstudio-cosmic (Milky2018/mgstudio_cosmic). Updated local deps/imports and .gitignore.","created_at":"2026-01-22T11:07:14Z"}]}
{"id":"moon-game-studio-i0b.1","title":"Port swash to MoonBit (rasterization core)","description":"Start mgstudio-swash port from ./swash: implement font parsing, glyph outlines, raster to alpha mask, placement offsets. Goal: replace Canvas2D glyph raster in web host.","status":"in_progress","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T18:42:52.397821+08:00","created_by":"Milky2018","updated_at":"2026-01-22T18:43:08.713169+08:00","dependencies":[{"issue_id":"moon-game-studio-i0b.1","depends_on_id":"moon-game-studio-i0b","type":"parent-child","created_at":"2026-01-22T18:42:52.398468+08:00","created_by":"Milky2018"},{"issue_id":"moon-game-studio-i0b.1","depends_on_id":"moon-game-studio-i0b.1.1","type":"blocks","created_at":"2026-01-22T19:36:03.65037+08:00","created_by":"Milky2018"},{"issue_id":"moon-game-studio-i0b.1","depends_on_id":"moon-game-studio-i0b.1.2","type":"blocks","created_at":"2026-01-22T19:44:46.748974+08:00","created_by":"Milky2018"},{"issue_id":"moon-game-studio-i0b.1","depends_on_id":"moon-game-studio-i0b.1.3","type":"blocks","created_at":"2026-01-22T19:52:39.280057+08:00","created_by":"Milky2018"},{"issue_id":"moon-game-studio-i0b.1","depends_on_id":"moon-game-studio-i0b.1.4","type":"blocks","created_at":"2026-01-22T20:00:19.646553+08:00","created_by":"Milky2018"},{"issue_id":"moon-game-studio-i0b.1","depends_on_id":"moon-game-studio-i0b.1.5","type":"blocks","created_at":"2026-01-22T20:00:19.798454+08:00","created_by":"Milky2018"},{"issue_id":"moon-game-studio-i0b.1","depends_on_id":"moon-game-studio-i0b.1.6","type":"blocks","created_at":"2026-01-22T20:00:19.947535+08:00","created_by":"Milky2018"}],"comments":[{"id":24,"issue_id":"moon-game-studio-i0b.1","author":"Milky2018","text":"Design recorded: .private/docs/text/SWASH_PORT.md (TDD-first, P0 scope: internal/parse + raw_data + FontRef/CMAP/glyf/raster). Next implementing internal::parse/raw_data tests \u0026 code.","created_at":"2026-01-22T11:03:49Z"},{"id":27,"issue_id":"moon-game-studio-i0b.1","author":"Milky2018","text":"Ported swash internal parse/raw_data (BeBytes/Stream + raw_data helpers) with MoonBit tests; moon test passes in mgstudio-swash.","created_at":"2026-01-22T11:15:50Z"},{"id":32,"issue_id":"moon-game-studio-i0b.1","author":"Milky2018","text":"Added CacheKey + FontDataRef/FontRef (basic collection support) and internal raw_font table directory helpers (table_range/table_data) with tests; note: RawFont trait can’t be implemented across MoonBit packages, so internal API uses explicit (data, base, tag).","created_at":"2026-01-22T11:27:42Z"},{"id":33,"issue_id":"moon-game-studio-i0b.1","author":"Milky2018","text":"Fix: internal::RawFont should be pub(open) to allow cross-package impl; restored RawFont-based table_range/table_data to match upstream swash.","created_at":"2026-01-22T11:33:01Z"}]}
{"id":"moon-game-studio-i0b.1.1","title":"mgstudio-swash: port cmap/charmap (codepoint-\u003eglyph)","description":"Port swash/src/internal/cmap.rs and swash/src/charmap.rs; add MoonBit tests + fixture font.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:35:50.879257+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:42:56.859021+08:00","closed_at":"2026-01-22T19:42:56.859024+08:00","comments":[{"id":40,"issue_id":"moon-game-studio-i0b.1.1","author":"Milky2018","text":"Implemented internal cmap (subtable/map/enumerate for format 4+12) + swash Charmap/CharmapProxy + synthetic font tests. moon test passes.","created_at":"2026-01-22T11:42:47Z"}]}
{"id":"moon-game-studio-i0b.1.2","title":"mgstudio-swash: port internal fixed/head/xmtx tables","description":"Port swash/src/internal/fixed.rs + head.rs + xmtx.rs (table structs + parsing) with tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:44:36.802969+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:51:25.614925+08:00","closed_at":"2026-01-22T19:51:25.614928+08:00","comments":[{"id":45,"issue_id":"moon-game-studio-i0b.1.2","author":"Milky2018","text":"Ported internal fixed (16.16 math) + head/maxp/hhea/vhea wrappers + xmtx metrics helpers; added tests; moon test passes.","created_at":"2026-01-22T11:51:17Z"}]}
{"id":"moon-game-studio-i0b.1.3","title":"mgstudio-swash: port internal glyf/loca accessors","description":"Port swash/src/internal/glyf.rs (GLYF/LOCA tags, get/ymax) + needed parse Stream helpers + tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:52:24.982144+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:54:54.331546+08:00","closed_at":"2026-01-22T19:54:54.331547+08:00","comments":[{"id":48,"issue_id":"moon-game-studio-i0b.1.3","author":"Milky2018","text":"Ported internal glyf/loca accessors (get/ymax) and extended Stream; added tests; moon test passes.","created_at":"2026-01-22T11:54:54Z"}]}
{"id":"moon-game-studio-i0b.1.4","title":"Port zeno to MoonBit (mgstudio-zeno)","description":"Vendor upstream zeno repo; port types/geometry/raster APIs used by swash (Point/Vector/Transform/Bounds/Verb/Placement/Mask/Scratch/Fill/etc) with tests.","status":"in_progress","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:59:47.635052+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:00:31.033337+08:00","comments":[{"id":59,"issue_id":"moon-game-studio-i0b.1.4","author":"Milky2018","text":"Bootstrapped mgstudio_zeno + vendored upstream zeno repo; added initial geometry subset (Vector/Point alias, Transform, Origin/Placement/Bounds) and Format enum; tests passing.","created_at":"2026-01-22T12:25:24Z"}]}
{"id":"moon-game-studio-i0b.1.4.1","title":"mgstudio-zeno: mask rasterization (fill) subset","description":"Implement zeno Mask/Scratch scan conversion for Alpha/Subpixel formats needed by swash Render; add tests.","status":"open","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T20:48:39.826642+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:48:39.826642+08:00","dependencies":[{"issue_id":"moon-game-studio-i0b.1.4.1","depends_on_id":"moon-game-studio-i0b.1.4","type":"parent-child","created_at":"2026-01-22T20:48:39.827324+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-i0b.1.5","title":"Port yazi to MoonBit (mgstudio-yazi)","description":"Vendor upstream yazi repo; port PNG/deflate decode APIs used by swash scale/bitmap/png.rs with tests.","status":"in_progress","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:59:58.287378+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:19:51.572372+08:00"}
{"id":"moon-game-studio-i0b.1.5.1","title":"mgstudio-yazi: PNG decode for swash bitmap","description":"Implement yazi png decode or port swash/src/scale/bitmap/png.rs dependencies (inflate/zlib/adler) to decode PNG; add tests.","status":"open","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T20:48:41.543282+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:48:41.543282+08:00","dependencies":[{"issue_id":"moon-game-studio-i0b.1.5.1","depends_on_id":"moon-game-studio-i0b.1.5","type":"parent-child","created_at":"2026-01-22T20:48:41.544083+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-i0b.1.6","title":"Port skrifa to MoonBit (mgstudio-skrifa)","description":"Vendor upstream fontations/skrifa; port the subset used by swash (FontRef, outline_glyphs, hinting interfaces, etc) with tests.","status":"open","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T20:00:07.935511+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:00:07.935511+08:00"}
{"id":"moon-game-studio-i0b.1.7","title":"mgstudio-swash: scale/image + scale/outline scaffolding","description":"Port swash/src/scale/image.rs and scale/outline.rs core data structures (Content/Image/Outline/Layer) using mgstudio-zeno types; add tests.","status":"in_progress","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T20:48:36.504973+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:49:20.855907+08:00","dependencies":[{"issue_id":"moon-game-studio-i0b.1.7","depends_on_id":"moon-game-studio-i0b.1","type":"parent-child","created_at":"2026-01-22T20:48:36.50566+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-i0b.1.8","title":"mgstudio-swash: OutlineGlyphCollection via skrifa (minimal)","description":"Port minimal subset of skrifa used by swash scale: FontRef::new/from_index + outline_glyphs + OutlinePen draw for glyf; align with swash/src/scale/mod.rs expectations; add tests.","status":"in_progress","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T20:48:38.334077+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:49:20.961546+08:00","dependencies":[{"issue_id":"moon-game-studio-i0b.1.8","depends_on_id":"moon-game-studio-i0b.1","type":"parent-child","created_at":"2026-01-22T20:48:38.334796+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-i0b.2","title":"Port cosmic-text to MoonBit (Buffer/layout/wrap)","description":"Start mgstudio-text port from ./cosmic-text: implement Buffer, shaping/layout pipeline and wrap/justify; integrate with mgstudio-swash for raster.","notes":"All P1.1~P1.5 landed in mgstudio-cosmic; remaining P1.6 integration blocked on mgstudio-swash API stabilization.","status":"blocked","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T18:42:54.336093+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:21:11.363583+08:00","dependencies":[{"issue_id":"moon-game-studio-i0b.2","depends_on_id":"moon-game-studio-i0b","type":"parent-child","created_at":"2026-01-22T18:42:54.336798+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-i0b.2.1","title":"mgstudio-cosmic MVP: wrap/layout tests (ASCII)","description":"Define minimal cosmic-text-aligned APIs (Metrics, Wrap, LayoutGlyph/LayoutLine) and implement ASCII-only wrap/layout with tests; no shaping yet.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:11:45.612918+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:17:40.135446+08:00","closed_at":"2026-01-22T19:17:40.135446+08:00","close_reason":"MVP wrap/layout tests landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.1","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:11:45.613684+08:00","created_by":"Milky2018"}],"comments":[{"id":26,"issue_id":"moon-game-studio-i0b.2.1","author":"Milky2018","text":"# mgstudio-cosmic MVP 设计（第一步：wrap/layout，ASCII）\n\n目标：在不引入完整 shaping/font fallback 的前提下，先把 `cosmic-text` 的 Buffer/layout “骨架 + 行折行策略”移植出来，并用测试驱动，保证后续替换 shaping 时 API 形状不需要大改。\n\n## 范围（MVP）\n\n- **对齐 upstream 类型命名**：`Metrics`、`Wrap`、`Align`、`LayoutGlyph`、`LayoutLine`。\n- **只做 ASCII 级别布局**（临时）：\n  - `Wrap::None`：不折行\n  - `Wrap::Word`：按空格折行（不做 Unicode word boundary）\n  - `Wrap::WordOrGlyph`：按空格折行，若单词自身超宽则回退到 glyph 折行\n  - `Wrap::Glyph`：按 glyph 折行\n- **glyph advance 临时策略**：用固定宽度（monospace）或测试注入的 advance（后续替换为 swash/cosmic 的 shaping 输出）。\n\n## 非目标（后续阶段）\n\n- 复杂脚本 shaping（harfbuzz）、BiDi、font fallback、字体数据库（fontdb）、以及 swash raster 集成。\n- 完整对齐 `cosmic-text` 的 `FontSystem/ShapeBuffer/ShapeLine` 等运行时结构。\n\n## 测试策略\n\n- 先写测试覆盖 wrap 行为（输入字符串、容器宽度、Wrap 模式 -\u003e 期望的行切分与行宽）。\n- 实现只需满足测试与 API 形状；后续替换 shaping 时保持这些测试不变或扩展（用于防回归）。\n\n## 与 upstream 对齐的约束\n\n- 公共 API 名称/枚举项尽量与 `cosmic-text/src/{buffer.rs,layout.rs}` 一致。\n- 任何与 upstream 不一致的行为（例如：word boundary 规则、空格处理、溢出策略）必须在本文件新增“差异记录”并先确认。\n\n","created_at":"2026-01-22T11:12:17Z"},{"id":28,"issue_id":"moon-game-studio-i0b.2.1","author":"Milky2018","text":"Implemented MVP ASCII wrap/layout slice in mgstudio-cosmic with tests (layout_ascii + Wrap/Align/LayoutGlyph/LayoutLine + Metrics stub). moon test passes.","created_at":"2026-01-22T11:17:30Z"}]}
{"id":"moon-game-studio-i0b.2.10","title":"mgstudio-cosmic: Buffer update flow (P1.2)","description":"Implement Buffer core update flow beyond set_text: per-line AttrsList creation, set_metrics, wrap/hinting setters, redraw semantics; add tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:54:13.938498+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:56:51.830033+08:00","closed_at":"2026-01-22T19:56:51.830033+08:00","close_reason":"Buffer update flow implemented","dependencies":[{"issue_id":"moon-game-studio-i0b.2.10","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:54:13.939106+08:00","created_by":"Milky2018"}],"comments":[{"id":49,"issue_id":"moon-game-studio-i0b.2.10","author":"Milky2018","text":"# mgstudio-cosmic：Buffer 更新流程（P1.2）设计\n\n目标：补齐 `cosmic-text/src/buffer.rs` 中 Buffer 的“更新/重布局/重绘标记”流程，使后续接入 shaping/layout 时接口不需要大改。\n\n## 范围（本阶段）\n\n- 结构字段对齐（逐步补齐）：\n  - `wrap`, `tab_width`, `hinting`, `monospace_width`, `scroll`, `redraw`\n- API（对齐命名/语义，先不引入 FontSystem）：\n  - `Buffer::set_wrap(wrap)`：变更时 `redraw=true`\n  - `Buffer::set_tab_width(tab_width)`：变更时 `redraw=true`\n  - `Buffer::set_hinting(hinting)`：变更时 `redraw=true`\n  - `Buffer::set_monospace_width(width_opt)`：变更时 `redraw=true`\n  - `Buffer::set_metrics(metrics)`：变更时 `redraw=true`（并检查 line_height != 0）\n\n备注：\n- upstream 的 `relayout()` 会在已有 shape 的行上重算 layout；我们当前未实现 shaping/layout，因此此处只做 redraw 标记与字段更新。\n\n","created_at":"2026-01-22T11:55:40Z"},{"id":50,"issue_id":"moon-game-studio-i0b.2.10","author":"Milky2018","text":"Implemented Buffer update-flow setters (set_wrap/set_tab_width/set_hinting/set_monospace_width/set_metrics) with redraw semantics + tests; moon test -p cosmic_text passes.","created_at":"2026-01-22T11:56:51Z"}]}
{"id":"moon-game-studio-i0b.2.11","title":"mgstudio-cosmic: minimal shaping (P1.3)","description":"Implement minimal shaping pipeline for Latin/ASCII (no harfbuzz yet) producing shape runs/glyph advances; keep API aligned with cosmic-text shape.rs; add tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:54:14.422928+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:02:26.874923+08:00","closed_at":"2026-01-22T20:02:26.874923+08:00","close_reason":"Minimal shaping scaffold landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.11","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:54:14.423596+08:00","created_by":"Milky2018"}],"comments":[{"id":52,"issue_id":"moon-game-studio-i0b.2.11","author":"Milky2018","text":"# mgstudio-cosmic：Shaping（P1.3）设计（对齐 cosmic-text/shape.rs）\n\n目标：实现一个“可用的最小 shaping”，先覆盖 Latin/ASCII 文本，并把数据流形状做成与 upstream 接近，后续再替换为 harfbuzz + font fallback。\n\n## MVP 范围\n\n- 引入 `ShapeGlyph`（对齐字段语义，先做子集）：\n  - `start/end`（cluster range，暂用 code unit index）\n  - `x_advance/x_offset`（Float，单位为 em；MVP 可直接用像素并在 layout 中约定）\n  - `font_id/glyph_id`（MVP 用 Int/Int，占位）\n  - `metadata`（来自 Attrs）\n- 引入 `ShapeLine`：\n  - `glyphs : Array[ShapeGlyph]`\n  - `rtl : Bool`（MVP 固定 false）\n  - `ShapeLine::build(text, attrs_list, shaping, tab_width)`（MVP：1 code unit -\u003e 1 glyph）\n\n## 非目标\n\n- harfbuzz shaping、Unicode script run、BiDi、fontdb、fallback 选择策略\n\n## 与 upstream 差异（已知）\n\n- upstream `glyph_id` 来自字体 shaping；MVP 先用 `code_unit` 值占位\n- upstream 单位换算（em vs px）先简化；后续接入 swash 后再对齐精确度\n\n","created_at":"2026-01-22T11:59:34Z"},{"id":53,"issue_id":"moon-game-studio-i0b.2.11","author":"Milky2018","text":"Implemented minimal shaping scaffold: ShapeGlyph/ShapeLine + BufferLine.shape cache fill (1 code unit -\u003e 1 glyph; tab uses tab_width cells) with tests; moon test -p cosmic_text passes.","created_at":"2026-01-22T12:02:26Z"}]}
{"id":"moon-game-studio-i0b.2.12","title":"mgstudio-cosmic: layout pipeline (P1.4)","description":"Implement layout pipeline producing LayoutLine/LayoutGlyph with align/wrap semantics, aligned with cosmic-text layout.rs/shape.rs; add tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:54:14.921054+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:12:19.701219+08:00","closed_at":"2026-01-22T20:12:19.701219+08:00","close_reason":"Layout pipeline MVP landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.12","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:54:14.921736+08:00","created_by":"Milky2018"}],"comments":[{"id":54,"issue_id":"moon-game-studio-i0b.2.12","author":"Milky2018","text":"# mgstudio-cosmic：Layout pipeline（P1.4）设计（对齐 cosmic-text/layout.rs + buffer_line.rs）\n\n目标：把 `BufferLine.layout(...) -\u003e \u0026[LayoutLine]` 的数据流跑通，并对齐 `cosmic-text` 的调用形态：\n\n- `BufferLine.shape(...)` 先产出 `ShapeLine`\n- `ShapeLine.layout_to_buffer(...)`（upstream）将结果写入 `LayoutLine/ LayoutGlyph`\n- `BufferLine.layout(...)` 缓存并返回 layout\n\n## MVP 范围\n\n先实现“能驱动 Text2d 的最小 layout”：\n\n- `LayoutGlyph`：补齐最少字段以支持布局与后续 raster/cache_key：\n  - `start/end`（cluster range；MVP 用 code unit index）\n  - `x/y/w`（像素坐标；MVP y=0）\n  - `x_offset/y_offset`（MVP=0）\n  - `metadata`（从 Attrs 继承）\n- `LayoutLine`：\n  - `w`\n  - `glyphs : Array[LayoutGlyph]`\n- `BufferLine.layout(font_size,width_opt,wrap,match_mono_width,tab_width,hinting)`：\n  - 在 `shape_opt` 缓存未准备时先调用 `shape(tab_width)`\n  - 使用 `ShapeGlyph.x_advance` 推导 glyph 的 `x` 与 `w`\n  - `wrap` 行为：复用现有 `layout_ascii` 思路（Word/Glyph/WordOrGlyph），但实现迁移到 `layout_from_shape`（基于 ShapeGlyph）\n  - `hinting`：本阶段只传递，不改变行为（与 `.private/docs/cosmic/BUFFER_METRICS_HINTING_DESIGN.md` 一致）\n\n## 与 upstream 差异（待后续收敛）\n\n- upstream `LayoutGlyph` 字段非常多（font_id/glyph_id/font_size/weight/level/color/cache_key_flags...），MVP 只保留最小集合，后续逐步补齐并保持语义一致。\n- upstream wrap 依赖 Unicode segmentation；当前 P1.1 仅实现 whitespace 分词，后续可替换为 UAX#29。\n\n","created_at":"2026-01-22T12:08:02Z"},{"id":55,"issue_id":"moon-game-studio-i0b.2.12","author":"Milky2018","text":"Implemented MVP layout pipeline: layout_from_shape + BufferLine.layout caching, producing LayoutLine/LayoutGlyph positions and wrap modes (Word/Glyph/WordOrGlyph) using whitespace segmentation; added tests; moon test -p cosmic_text passes.","created_at":"2026-01-22T12:12:19Z"}]}
{"id":"moon-game-studio-i0b.2.13","title":"mgstudio-cosmic: wrap/justify integration (P1.5)","description":"Implement LineBreak/Justify behaviors used by Bevy Text2d alignment; wire into layout; add tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:54:15.402317+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:18:06.866427+08:00","closed_at":"2026-01-22T20:18:06.866427+08:00","close_reason":"Wrap/justify integration landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.13","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:54:15.402995+08:00","created_by":"Milky2018"}],"comments":[{"id":56,"issue_id":"moon-game-studio-i0b.2.13","author":"Milky2018","text":"# mgstudio-cosmic：Justify / LineBreak（P1.5）设计\n\n目标：补齐 Text2d 需要的对齐与换行策略抽象，并尽量对齐 `cosmic-text` 的 `Align`/`Wrap` 语义与调用方式。\n\n## 1. LineBreak（换行策略）\n\n我们提供 `LineBreak`（面向 Bevy/Text2d），并映射到 cosmic 的 `Wrap`：\n\n- `LineBreak::NoWrap` -\u003e `Wrap::None`\n- `LineBreak::AnyCharacter` -\u003e `Wrap::Glyph`\n- `LineBreak::WordBoundary` -\u003e `Wrap::WordOrGlyph`\n\n备注：upstream cosmic-text 直接用 `Wrap`；这里是为了和引擎侧 API 对齐（属于“适配层”，不改变核心语义）。\n\n## 2. Justify（水平对齐）\n\n我们提供 `Justify`（面向 Bevy/Text2d），并映射到 cosmic 的 `Align`：\n\n- `Justify::Left` -\u003e `Align::Left`\n- `Justify::Right` -\u003e `Align::Right`\n- `Justify::Center` -\u003e `Align::Center`\n- `Justify::Justified` -\u003e `Align::Justified`\n\n## 3. 布局实现\n\n在 `BufferLine.layout(...)` 中：\n\n1) 先按 wrap 生成左对齐的 `LayoutLine/LayoutGlyph`\n2) 若提供了 `width_opt`，再根据 `align` 对 glyph 的 `x` 做二次调整：\n   - `Left`：不变\n   - `Center`：整体平移 `(width - line_w)/2`\n   - `Right/End`：整体平移 `(width - line_w)`\n   - `Justified`：把额外宽度平均分配到该行中的空格 glyph（仅 MVP，后续可对齐 upstream 更复杂规则）\n\n","created_at":"2026-01-22T12:13:57Z"},{"id":57,"issue_id":"moon-game-studio-i0b.2.13","author":"Milky2018","text":"Implemented Justify/LineBreak mapping layer and Align application (Left/Center/Right/End/Justified) via apply_align; BufferLine.layout now applies align when width is provided; added tests; moon test -p cosmic_text passes.","created_at":"2026-01-22T12:18:06Z"}]}
{"id":"moon-game-studio-i0b.2.14","title":"mgstudio-cosmic: integrate with mgstudio-swash (P1.6)","description":"Integrate mgstudio-cosmic shaping/layout output with mgstudio-swash glyph raster/cache_key/placement pipeline; requires mgstudio-swash API stabilization.","notes":"Waiting on mgstudio-swash API stabilization (cache_key/placement/raster)","status":"blocked","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:54:16.931809+08:00","created_by":"Milky2018","updated_at":"2026-01-22T20:19:09.643867+08:00","dependencies":[{"issue_id":"moon-game-studio-i0b.2.14","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:54:16.932582+08:00","created_by":"Milky2018"}],"comments":[{"id":58,"issue_id":"moon-game-studio-i0b.2.14","author":"Milky2018","text":"# mgstudio-cosmic \u003c-\u003e mgstudio-swash 集成（P1.6）设计（待 swash API 稳定）\n\n目标：让 `mgstudio-cosmic` 的 layout 输出能够驱动 `mgstudio-swash` 完成 glyph raster，并与引擎侧 FontAtlasSet 对齐 Bevy 的 Text2d 流程。\n\n## 需要 swash 提供的最小能力（对齐 cosmic-text/swash.rs）\n\n- `CacheKey`：由 (font_id, glyph_id, font_size, subpixel offset, weight, flags...) 生成，作为 atlas cache key\n- `Placement`：glyph 位图在基线坐标系下的放置（left/top/width/height + offsets）\n- `Render`：给定 cache_key/font + glyph_id/size，输出 mask/RGBA bitmap + placement\n\n## cosmic 侧输出（当前已具备）\n\n- `LayoutGlyph`（MVP）：包含 `start/end/x/y/w/x_offset/y_offset/metadata`\n- 后续需要补齐：font_id/glyph_id/font_size/cache_key_flags 等字段，以便无损生成 CacheKey\n\n## 阻塞项\n\n当前 `mgstudio-swash` 仍在 P0.1~P0.5 移植过程中，API 形状未稳定，且工程当前存在编译错误会阻断在 `mgstudio-cosmic` 内直接 import。\n\n## 下一步（依赖 swash 侧）\n\n1) 在 `mgstudio-swash` 明确并稳定 `CacheKey/Placement/Render` API（对齐 upstream swash/cosmic-text）\n2) `mgstudio-cosmic` 补齐 LayoutGlyph 相关字段（font_id/glyph_id/font_size/flags）\n3) 在引擎侧（Text2d）替换 Canvas2D raster，改走 swash raster + atlas\n\n","created_at":"2026-01-22T12:19:49Z"}]}
{"id":"moon-game-studio-i0b.2.2","title":"mgstudio-cosmic: port Cached + LineEnding (+tests)","description":"Port cosmic-text cached.rs and line_ending.rs (LineEnding + LineIter) with MoonBit tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:22:51.544021+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:34:20.640935+08:00","closed_at":"2026-01-22T19:34:20.640935+08:00","close_reason":"cached + line_ending ports landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.2","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:22:51.544741+08:00","created_by":"Milky2018"}],"comments":[{"id":29,"issue_id":"moon-game-studio-i0b.2.2","author":"Milky2018","text":"# mgstudio-cosmic：BufferLine / AttrsList 设计（对齐 cosmic-text）\n\n本文件用于在实现前确认设计，目标是尽可能照搬 `./cosmic-text`（必要时做最小 MoonBit 适配，并记录差异）。\n\n## 1. LineEnding + LineIter\n\n对齐 `cosmic-text/src/line_ending.rs`：\n\n- `LineEnding` 枚举：`Lf | CrLf | Cr | LfCr | None`\n- `LineEnding::as_str()` 返回对应结尾字符串\n- `LineIter`：迭代返回 `(start, end, ending)`，其中 `[start,end)` 是本行内容范围，`ending` 是该行的结尾类型\n- 测试用例与 upstream 相同：`\"LF\\nCRLF\\r\\nCR\\rLFCR\\n\\rNONE\"`\n\n差异：MoonBit 没有 Rust 的 `Range\u003cusize\u003e`，用 `(Int, Int)` 表示 `[start,end)`.\n\n## 2. Cached[T]\n\n对齐 `cosmic-text/src/cached.rs`：\n\n- `Cached[T]`：`Empty | Unused(T) | Used(T)`\n- 需要的 API：\n  - `get() -\u003e T?`（仅 Used 返回 Some）\n  - `is_unused() -\u003e Bool`（Empty/Unused 为 true）\n  - `take_unused() -\u003e (Cached[T], T?)`（函数式风格返回新值；语义与 upstream 一致）\n  - `take_used() -\u003e (Cached[T], T?)`\n  - `set_unused() -\u003e Cached[T]`（Used -\u003e Unused）\n  - `set_used(val) -\u003e Cached[T]`\n\n差异：Rust 是 `\u0026mut self` 原地变更；MoonBit 采用“返回新值”更新（保持语义一致，便于测试与后续替换）。\n\n## 3. Attrs / AttrsList（Span Map）\n\n对齐 `cosmic-text/src/attrs.rs` 的“行为”，但先做最小字段集合以支持 BufferLine：\n\n- `Attrs`：先保留最小字段 `metadata : Int`（后续再逐步补齐 color/weight/style/features 等）\n- `AttrsList`：\n  - `defaults : Attrs`\n  - `spans : Array[AttrsSpan]`（按 start 升序，区间为半开区间 `[start,end)`）\n  - `add_span(start,end,attrs)`：追加一个覆盖范围（MVP 不做 rangemap 合并；后续需要再补）\n  - `get_span(pos)`：返回覆盖 pos 的最后一个 span（无覆盖返回 defaults）\n  - `split_off(index)`：把文本在 index 处分成左右两份，右侧 spans 需要整体 `start/end -= index`\n  - `spans_iter()`：用于 append 复制 spans\n\n差异（待确认）：Rust 使用 `rangemap::RangeMap`，我们 MVP 用“有序 spans 数组 + 线性查询”实现；后续若性能不足再替换为更高效结构，但保持 API 不变。\n\n## 4. BufferLine\n\n对齐 `cosmic-text/src/buffer_line.rs`（核心行为优先）：\n\n- 字段：`text`、`ending`、`attrs_list`、`align`、`shape_opt`、`layout_opt`、`shaping`、`metadata`\n- 行为：\n  - `new(...)`\n  - `reset_new(...)`：复用缓存（MoonBit 版本用 Cached 的 Unused 语义模拟）\n  - `set_text(...) -\u003e Bool`：text/ending/attrs_list 任一变化则 reset 并返回 true\n  - `append(other)`：拼接文本；复制 attrs spans（保留 ending=other.ending）；默认 attrs 不同时需要额外 span\n  - `split_off(index)`：按 index 拆分出新行；原行 ending 变为 None；新行继承 align\n\n差异：同 Cached 一样，Rust 是 \u0026mut self；MoonBit 初版允许用“返回新值”的函数式写法实现（但外部 API 命名/语义对齐）。\n\n","created_at":"2026-01-22T11:23:48Z"},{"id":34,"issue_id":"moon-game-studio-i0b.2.2","author":"Milky2018","text":"Implemented Cached[T] + LineEnding/LineIter ports in mgstudio-cosmic with tests (aligned with cosmic-text/cached.rs + line_ending.rs).","created_at":"2026-01-22T11:34:20Z"}]}
{"id":"moon-game-studio-i0b.2.3","title":"mgstudio-cosmic: port Attrs/AttrsList span map (+tests)","description":"Define Attrs and AttrsList data model close to cosmic-text/attrs.rs; implement minimal span storage + split_off/add_span/get_span, with tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:22:58.872723+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:34:20.857573+08:00","closed_at":"2026-01-22T19:34:20.857573+08:00","close_reason":"AttrsList MVP landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.3","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:22:58.8735+08:00","created_by":"Milky2018"}],"comments":[{"id":30,"issue_id":"moon-game-studio-i0b.2.3","author":"Milky2018","text":"# mgstudio-cosmic：BufferLine / AttrsList 设计（对齐 cosmic-text）\n\n本文件用于在实现前确认设计，目标是尽可能照搬 `./cosmic-text`（必要时做最小 MoonBit 适配，并记录差异）。\n\n## 1. LineEnding + LineIter\n\n对齐 `cosmic-text/src/line_ending.rs`：\n\n- `LineEnding` 枚举：`Lf | CrLf | Cr | LfCr | None`\n- `LineEnding::as_str()` 返回对应结尾字符串\n- `LineIter`：迭代返回 `(start, end, ending)`，其中 `[start,end)` 是本行内容范围，`ending` 是该行的结尾类型\n- 测试用例与 upstream 相同：`\"LF\\nCRLF\\r\\nCR\\rLFCR\\n\\rNONE\"`\n\n差异：MoonBit 没有 Rust 的 `Range\u003cusize\u003e`，用 `(Int, Int)` 表示 `[start,end)`.\n\n## 2. Cached[T]\n\n对齐 `cosmic-text/src/cached.rs`：\n\n- `Cached[T]`：`Empty | Unused(T) | Used(T)`\n- 需要的 API：\n  - `get() -\u003e T?`（仅 Used 返回 Some）\n  - `is_unused() -\u003e Bool`（Empty/Unused 为 true）\n  - `take_unused() -\u003e (Cached[T], T?)`（函数式风格返回新值；语义与 upstream 一致）\n  - `take_used() -\u003e (Cached[T], T?)`\n  - `set_unused() -\u003e Cached[T]`（Used -\u003e Unused）\n  - `set_used(val) -\u003e Cached[T]`\n\n差异：Rust 是 `\u0026mut self` 原地变更；MoonBit 采用“返回新值”更新（保持语义一致，便于测试与后续替换）。\n\n## 3. Attrs / AttrsList（Span Map）\n\n对齐 `cosmic-text/src/attrs.rs` 的“行为”，但先做最小字段集合以支持 BufferLine：\n\n- `Attrs`：先保留最小字段 `metadata : Int`（后续再逐步补齐 color/weight/style/features 等）\n- `AttrsList`：\n  - `defaults : Attrs`\n  - `spans : Array[AttrsSpan]`（按 start 升序，区间为半开区间 `[start,end)`）\n  - `add_span(start,end,attrs)`：追加一个覆盖范围（MVP 不做 rangemap 合并；后续需要再补）\n  - `get_span(pos)`：返回覆盖 pos 的最后一个 span（无覆盖返回 defaults）\n  - `split_off(index)`：把文本在 index 处分成左右两份，右侧 spans 需要整体 `start/end -= index`\n  - `spans_iter()`：用于 append 复制 spans\n\n差异（待确认）：Rust 使用 `rangemap::RangeMap`，我们 MVP 用“有序 spans 数组 + 线性查询”实现；后续若性能不足再替换为更高效结构，但保持 API 不变。\n\n## 4. BufferLine\n\n对齐 `cosmic-text/src/buffer_line.rs`（核心行为优先）：\n\n- 字段：`text`、`ending`、`attrs_list`、`align`、`shape_opt`、`layout_opt`、`shaping`、`metadata`\n- 行为：\n  - `new(...)`\n  - `reset_new(...)`：复用缓存（MoonBit 版本用 Cached 的 Unused 语义模拟）\n  - `set_text(...) -\u003e Bool`：text/ending/attrs_list 任一变化则 reset 并返回 true\n  - `append(other)`：拼接文本；复制 attrs spans（保留 ending=other.ending）；默认 attrs 不同时需要额外 span\n  - `split_off(index)`：按 index 拆分出新行；原行 ending 变为 None；新行继承 align\n\n差异：同 Cached 一样，Rust 是 \u0026mut self；MoonBit 初版允许用“返回新值”的函数式写法实现（但外部 API 命名/语义对齐）。\n\n","created_at":"2026-01-22T11:23:48Z"},{"id":35,"issue_id":"moon-game-studio-i0b.2.3","author":"Milky2018","text":"Implemented MVP Attrs + AttrsList span map (add_span/get_span/split_off/eq) with tests.","created_at":"2026-01-22T11:34:20Z"}]}
{"id":"moon-game-studio-i0b.2.4","title":"mgstudio-cosmic: port BufferLine core (cache reset/append/split_off)","description":"Port cosmic-text/buffer_line.rs core behaviors (set_text/reset/append/split_off) using Cached+LineEnding+AttrsList; cover with tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:23:07.057607+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:34:21.095417+08:00","closed_at":"2026-01-22T19:34:21.095417+08:00","close_reason":"BufferLine MVP landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.4","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:23:07.058299+08:00","created_by":"Milky2018"}],"comments":[{"id":31,"issue_id":"moon-game-studio-i0b.2.4","author":"Milky2018","text":"# mgstudio-cosmic：BufferLine / AttrsList 设计（对齐 cosmic-text）\n\n本文件用于在实现前确认设计，目标是尽可能照搬 `./cosmic-text`（必要时做最小 MoonBit 适配，并记录差异）。\n\n## 1. LineEnding + LineIter\n\n对齐 `cosmic-text/src/line_ending.rs`：\n\n- `LineEnding` 枚举：`Lf | CrLf | Cr | LfCr | None`\n- `LineEnding::as_str()` 返回对应结尾字符串\n- `LineIter`：迭代返回 `(start, end, ending)`，其中 `[start,end)` 是本行内容范围，`ending` 是该行的结尾类型\n- 测试用例与 upstream 相同：`\"LF\\nCRLF\\r\\nCR\\rLFCR\\n\\rNONE\"`\n\n差异：MoonBit 没有 Rust 的 `Range\u003cusize\u003e`，用 `(Int, Int)` 表示 `[start,end)`.\n\n## 2. Cached[T]\n\n对齐 `cosmic-text/src/cached.rs`：\n\n- `Cached[T]`：`Empty | Unused(T) | Used(T)`\n- 需要的 API：\n  - `get() -\u003e T?`（仅 Used 返回 Some）\n  - `is_unused() -\u003e Bool`（Empty/Unused 为 true）\n  - `take_unused() -\u003e (Cached[T], T?)`（函数式风格返回新值；语义与 upstream 一致）\n  - `take_used() -\u003e (Cached[T], T?)`\n  - `set_unused() -\u003e Cached[T]`（Used -\u003e Unused）\n  - `set_used(val) -\u003e Cached[T]`\n\n差异：Rust 是 `\u0026mut self` 原地变更；MoonBit 采用“返回新值”更新（保持语义一致，便于测试与后续替换）。\n\n## 3. Attrs / AttrsList（Span Map）\n\n对齐 `cosmic-text/src/attrs.rs` 的“行为”，但先做最小字段集合以支持 BufferLine：\n\n- `Attrs`：先保留最小字段 `metadata : Int`（后续再逐步补齐 color/weight/style/features 等）\n- `AttrsList`：\n  - `defaults : Attrs`\n  - `spans : Array[AttrsSpan]`（按 start 升序，区间为半开区间 `[start,end)`）\n  - `add_span(start,end,attrs)`：追加一个覆盖范围（MVP 不做 rangemap 合并；后续需要再补）\n  - `get_span(pos)`：返回覆盖 pos 的最后一个 span（无覆盖返回 defaults）\n  - `split_off(index)`：把文本在 index 处分成左右两份，右侧 spans 需要整体 `start/end -= index`\n  - `spans_iter()`：用于 append 复制 spans\n\n差异（待确认）：Rust 使用 `rangemap::RangeMap`，我们 MVP 用“有序 spans 数组 + 线性查询”实现；后续若性能不足再替换为更高效结构，但保持 API 不变。\n\n## 4. BufferLine\n\n对齐 `cosmic-text/src/buffer_line.rs`（核心行为优先）：\n\n- 字段：`text`、`ending`、`attrs_list`、`align`、`shape_opt`、`layout_opt`、`shaping`、`metadata`\n- 行为：\n  - `new(...)`\n  - `reset_new(...)`：复用缓存（MoonBit 版本用 Cached 的 Unused 语义模拟）\n  - `set_text(...) -\u003e Bool`：text/ending/attrs_list 任一变化则 reset 并返回 true\n  - `append(other)`：拼接文本；复制 attrs spans（保留 ending=other.ending）；默认 attrs 不同时需要额外 span\n  - `split_off(index)`：按 index 拆分出新行；原行 ending 变为 None；新行继承 align\n\n差异：同 Cached 一样，Rust 是 \u0026mut self；MoonBit 初版允许用“返回新值”的函数式写法实现（但外部 API 命名/语义对齐）。\n\n","created_at":"2026-01-22T11:23:48Z"},{"id":36,"issue_id":"moon-game-studio-i0b.2.4","author":"Milky2018","text":"Implemented BufferLine MVP (set_text/reset/append/split_off) with tests; uses functional Cached updates.","created_at":"2026-01-22T11:34:20Z"}]}
{"id":"moon-game-studio-i0b.2.5","title":"mgstudio-cosmic: port Buffer core (buffer.rs) + tests","description":"Port cosmic-text/src/buffer.rs core Buffer structure and line management (LineIter split, set_text, set_size, wrap, redraw) with tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:36:53.256654+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:38:57.066528+08:00","closed_at":"2026-01-22T19:38:57.066528+08:00","close_reason":"Buffer MVP landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.5","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:36:53.257371+08:00","created_by":"Milky2018"}],"comments":[{"id":37,"issue_id":"moon-game-studio-i0b.2.5","author":"Milky2018","text":"# mgstudio-cosmic：Buffer 设计（对齐 cosmic-text/buffer.rs）\n\n目标：照搬 `cosmic-text/src/buffer.rs` 的 `Buffer` 核心数据结构与“文本行管理/缓存失效/redraw 标记”语义，先实现可测试的最小闭环，再逐步补齐 shaping/scroll/cursor 等高级功能。\n\n## 1. MVP 范围\n\n- `Buffer` 字段（先做最小集合）：\n  - `lines : Array[BufferLine]`\n  - `metrics : Metrics`\n  - `width_opt : Float?`\n  - `height_opt : Float?`\n  - `redraw : Bool`\n  - `wrap : Wrap`\n  - `tab_width : Int`\n- API（对齐命名/语义）：\n  - `Buffer::new(metrics)` 创建空 buffer\n  - `Buffer::set_size(width_opt,height_opt)` 变更尺寸时设置 `redraw=true`\n  - `Buffer::set_text(text, attrs_list, shaping)` 使用 `LineIter` 拆分成多行 `BufferLine`\n  - `Buffer::lines()` / `Buffer::metrics()` 只读访问\n\n## 2. 非目标（后续阶段）\n\n- `Scroll` / `LayoutRunIter` / `Cursor` / 编辑操作（insert/delete/motion）\n- `monospace_width` / `hinting` 以及 layout pipeline\n- 完整的 `Attrs/Color/FontSystem` 等\n\n## 3. 与 upstream 的差异\n\n- Rust 的 `Vec\u003cBufferLine\u003e` -\u003e MoonBit `Array[BufferLine]`\n- Rust 的 `LineIter` 返回 `Range\u003cusize\u003e` -\u003e MoonBit 返回 `(start,end,ending)`；取子串使用 `StringView::view` + `StringBuilder`（避免直接切片触发 error）\n\n","created_at":"2026-01-22T11:37:28Z"},{"id":38,"issue_id":"moon-game-studio-i0b.2.5","author":"Milky2018","text":"Moved .private/docs/text -\u003e .private/docs/cosmic. Implemented Buffer MVP (set_text line splitting via LineIter, set_size redraw) with tests; moon test -p cosmic_text passes.","created_at":"2026-01-22T11:38:56Z"}]}
{"id":"moon-game-studio-i0b.2.6","title":"mgstudio-cosmic: port Cursor/Affinity/Scroll/Motion (+tests)","description":"Port cosmic-text/src/cursor.rs core types (Cursor, Affinity, LayoutCursor, Motion, Scroll) with tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:40:46.801438+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:42:49.439867+08:00","closed_at":"2026-01-22T19:42:49.439867+08:00","close_reason":"cursor/scroll types landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.6","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:40:46.802192+08:00","created_by":"Milky2018"}],"comments":[{"id":39,"issue_id":"moon-game-studio-i0b.2.6","author":"Milky2018","text":"# mgstudio-cosmic：Cursor/Scroll 设计（对齐 cosmic-text/cursor.rs）\n\n目标：移植 `cosmic-text/src/cursor.rs` 的核心数据结构与语义，为后续 Buffer 编辑、shape/layout、scroll-to-cursor 行为打基础。\n\n## 类型\n\n- `Cursor { line, index, affinity }`\n  - `Cursor::new(line,index)` 默认 `Affinity::Before`\n  - `Cursor::new_with_affinity(line,index,affinity)`\n- `Affinity { Before | After }`\n  - `before()/after()` 判定\n  - `from_before(bool)` / `from_after(bool)`\n- `LayoutCursor { line, layout, glyph }`\n- `Motion`：枚举项与 upstream 保持一致（先移植类型，不实现 motion 行为）\n- `Scroll { line, vertical, horizontal }`\n  - `Scroll::new(line,vertical,horizontal)`\n\n## Buffer 默认值对齐（补充）\n\n我们将 `Buffer::new`/`new_empty` 的默认值对齐 upstream：\n- `redraw=false`\n- `wrap=WordOrGlyph`\n- `tab_width=8`\n- `scroll=Scroll::default()`（0,0,0）\n\n（此处属于“向上游对齐”，不是偏离。）\n\n","created_at":"2026-01-22T11:41:15Z"},{"id":41,"issue_id":"moon-game-studio-i0b.2.6","author":"Milky2018","text":"Ported cursor.rs core types (Cursor/Affinity/LayoutCursor/Motion/Scroll) into mgstudio-cosmic with tests; aligned Buffer defaults (redraw/wrap/tab_width/scroll) to upstream.","created_at":"2026-01-22T11:42:49Z"}]}
{"id":"moon-game-studio-i0b.2.7","title":"mgstudio-cosmic: align Metrics/Hinting/Buffer new_empty API to upstream (+tests)","description":"Port Metrics helpers (relative/scale), Hinting enum, and Buffer::new_empty/wrap/tab_width/hinting defaults closer to cosmic-text/buffer.rs + layout.rs, with tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:45:19.449418+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:49:02.169169+08:00","closed_at":"2026-01-22T19:49:02.169169+08:00","close_reason":"metrics/hinting/buffer defaults aligned","dependencies":[{"issue_id":"moon-game-studio-i0b.2.7","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:45:19.450227+08:00","created_by":"Milky2018"}],"comments":[{"id":42,"issue_id":"moon-game-studio-i0b.2.7","author":"Milky2018","text":"# mgstudio-cosmic：Metrics/Hinting/Buffer 默认值对齐（对齐 cosmic-text）\n\n目标：继续把 `mgstudio-cosmic` 的基础类型与 `cosmic-text` 对齐，减少后续 shape/layout/scroll 迁移时的 API 返工。\n\n## 1. Metrics\n\n对齐 `cosmic-text/src/buffer.rs`：\n\n- `Metrics::new(font_size,line_height)`\n- `Metrics::relative(font_size,line_height_scale)`：`line_height = font_size * line_height_scale`\n- `Metrics::scale(scale)`：同时缩放 font_size 与 line_height\n\n## 2. Hinting\n\n对齐 `cosmic-text/src/layout.rs`：\n\n- `Hinting::Disabled`（默认）\n- `Hinting::Enabled`\n\n（MVP 只移植枚举类型，不实现 hinting 行为。）\n\n## 3. Buffer::new_empty / 默认值\n\n对齐 `cosmic-text/src/buffer.rs::new_empty`：\n\n- 若 `metrics.line_height == 0`：直接失败（upstream panic；MoonBit 用 fail 表达不可恢复错误）\n- 默认值：\n  - `redraw=false`\n  - `wrap=WordOrGlyph`\n  - `tab_width=8`\n  - `scroll=Scroll::default()`\n  - `hinting=Hinting::Disabled`\n  - `monospace_width=None`（后续实现）\n\n差异：\n- 由于当前没有 `FontSystem`，`Buffer::new(font_system, metrics)` 暂不实现，只提供 `new_empty`/`new`（new 调用 new_empty）。\n\n","created_at":"2026-01-22T11:45:52Z"},{"id":43,"issue_id":"moon-game-studio-i0b.2.7","author":"Milky2018","text":"Ported Metrics::relative/scale, added Hinting enum, added Buffer::new_empty with upstream defaults + line_height==0 abort; added tests. moon test -p cosmic_text passes.","created_at":"2026-01-22T11:49:02Z"}]}
{"id":"moon-game-studio-i0b.2.8","title":"mgstudio-cosmic: port Color helpers from attrs.rs (+tests)","description":"Port cosmic-text/src/attrs.rs Color (rgb/rgba/as_rgba/r/g/b/a) with tests; keep Attrs minimal for now.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:50:00.918322+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:51:28.942321+08:00","closed_at":"2026-01-22T19:51:28.942321+08:00","close_reason":"Color port landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.8","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:50:00.918987+08:00","created_by":"Milky2018"}],"comments":[{"id":44,"issue_id":"moon-game-studio-i0b.2.8","author":"Milky2018","text":"# mgstudio-cosmic：Color 设计（对齐 cosmic-text/attrs.rs）\n\n目标：补齐 `cosmic-text/src/attrs.rs` 中最基础且无外部依赖的 `Color` 类型，为后续 Attrs 扩展与渲染集成做准备。\n\n## 类型与 API\n\n- `Color(pub UInt)`（32-bit packed ARGB，与 upstream 一致：`(a\u003c\u003c24)|(r\u003c\u003c16)|(g\u003c\u003c8)|b`）\n- 构造：\n  - `Color::rgb(r,g,b)`（a=0xFF）\n  - `Color::rgba(r,g,b,a)`\n- 访问：\n  - `r()/g()/b()/a() -\u003e Byte`\n  - `as_rgba() -\u003e (Byte,Byte,Byte,Byte)`（返回顺序与 upstream 一致：r,g,b,a）\n\n备注：本阶段不引入 `fontdb`/`rangemap` 等依赖；`Attrs` 仍保持最小字段集合。\n\n","created_at":"2026-01-22T11:50:33Z"},{"id":46,"issue_id":"moon-game-studio-i0b.2.8","author":"Milky2018","text":"Ported Color (rgb/rgba + component accessors) from cosmic-text attrs.rs into mgstudio-cosmic with tests.","created_at":"2026-01-22T11:51:28Z"}]}
{"id":"moon-game-studio-i0b.2.9","title":"mgstudio-cosmic: word boundary + segmentation (P1.1)","description":"Implement word boundary/segmentation utilities used by Wrap/Justify and cursor motion; start with whitespace-based segmentation aligned with current ASCII MVP; add tests.","status":"closed","priority":0,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T19:54:13.432107+08:00","created_by":"Milky2018","updated_at":"2026-01-22T19:58:33.550091+08:00","closed_at":"2026-01-22T19:58:33.550091+08:00","close_reason":"Segmentation MVP landed","dependencies":[{"issue_id":"moon-game-studio-i0b.2.9","depends_on_id":"moon-game-studio-i0b.2","type":"parent-child","created_at":"2026-01-22T19:54:13.432794+08:00","created_by":"Milky2018"}],"comments":[{"id":47,"issue_id":"moon-game-studio-i0b.2.9","author":"Milky2018","text":"# mgstudio-cosmic：Segmentation（P1.1）设计\n\n目标：为 `Wrap::Word` / `Motion::{*Word}` / 文本编辑提供“可用的”单词边界能力，并尽量对齐 `cosmic-text` 使用的 `unicode_segmentation` 行为。\n\n## 现状与限制\n\n- upstream 依赖 `unicode_segmentation::UnicodeSegmentation`（UAX #29 完整实现）。\n- 目前我们没有等价 MoonBit 库可直接使用；完整移植 UAX #29 的成本很高。\n\n## MVP 决策（需确认）\n\n先实现 **Whitespace-based word segmentation**（按空白分词）：\n\n- “word” 定义：连续的非空白 UTF-16 code unit 序列\n- 空白定义：`' '`, `\\\\t`, `\\\\n`, `\\\\r`\n- API：\n  - `word_indices_whitespace(s) -\u003e Array[(start,end)]`（返回每个 word 的 `[start,end)` code unit 范围）\n\n备注：\n- 该实现足以支撑 Bevy/examples/2d 的英文标签与基础交互。\n- 后续如果需要对齐复杂脚本/标点规则，再单独移植 UAX #29（可作为 P1.1.2）。\n\n","created_at":"2026-01-22T11:54:53Z"},{"id":51,"issue_id":"moon-game-studio-i0b.2.9","author":"Milky2018","text":"Implemented whitespace-based word segmentation (word_indices_whitespace) with tests. NOTE: this is a UAX#29 subset; see .private/docs/cosmic/SEGMENTATION_DESIGN.md.","created_at":"2026-01-22T11:58:33Z"}]}
{"id":"moon-game-studio-j7f","title":"Align mgstudio_physics collision/query/control with rapier semantics","description":"Replace simplified collision detection/resolution and character controller stubs with rapier-accurate broadphase/narrowphase, rotation-aware shapes, and query pipeline behavior.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T09:08:58.397867+08:00","created_by":"Milky2018","updated_at":"2026-01-22T09:08:58.397867+08:00"}
{"id":"moon-game-studio-jkj","title":"Confirm host/web location or relocate","description":"Decide final location for browser host bridge (current: mgstudio-engine/host/web). Move to platform/web or mgstudio-page if needed.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T17:47:14.643816+08:00","created_by":"Milky2018","updated_at":"2026-01-20T17:50:58.60998+08:00","closed_at":"2026-01-20T17:50:58.60998+08:00","close_reason":"Moved host bridge to mgstudio-engine/platform/web"}
{"id":"moon-game-studio-jvj","title":"Allow switching examples via reload param","description":"When an example is running, clicking another example reloads with ?run=... and auto-runs it.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T12:35:41.807953+08:00","created_by":"Milky2018","updated_at":"2026-01-21T12:36:09.935495+08:00","closed_at":"2026-01-21T12:36:09.935495+08:00","close_reason":"Closed"}
{"id":"moon-game-studio-lvq","title":"Rewrite web runtime loader in MoonBit (mizchi/js)","notes":"Implemented MoonBit runtime loader (mizchi/js), updated build.sh to build JS runtime, main.js now loads compiled runtime output.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-21T17:00:21.161346+08:00","updated_at":"2026-01-21T17:27:04.720112+08:00","closed_at":"2026-01-21T17:27:04.720114+08:00"}
{"id":"moon-game-studio-m0q","title":"Align IslandManager sleep/optimizer traversal to rapier","description":"Port IslandManager sleep extraction, optimizer splitting/merging, and traversal behavior to match rapier island_manager/*; update wake-up semantics and ContactGraph integration.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T10:40:39.708997+08:00","created_by":"Milky2018","updated_at":"2026-01-22T10:43:33.499318+08:00","closed_at":"2026-01-22T10:43:33.499318+08:00","close_reason":"done"}
{"id":"moon-game-studio-my1","title":"Refine IslandManager traversal/optimizer alignment","description":"Align IslandManager sleep traversal, merge/split optimizer, and add whitebox tests following rapier island_manager/*.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T11:58:19.577848+08:00","created_by":"Milky2018","updated_at":"2026-01-22T11:58:44.656557+08:00","closed_at":"2026-01-22T11:58:44.656557+08:00","close_reason":"done"}
{"id":"moon-game-studio-q66","title":"Implement 2d_viewport_to_world example","description":"Add simplified 2d_viewport_to_world example (mouse to world -\u003e sprite follow; arrow keys move camera). No viewport/zoom yet. Hook to runner exports and web menu. After browser verification, update  and ROADMAP_PHASE1.md.","notes":"Add host_debug_string throttle log for primary camera in 2d_viewport_to_world example.","status":"in_progress","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T12:22:50.109274+08:00","created_by":"Milky2018","updated_at":"2026-01-22T10:14:10.591851+08:00","comments":[{"id":7,"issue_id":"moon-game-studio-q66","author":"Milky2018","text":"Updated 2d_viewport_to_world example to use Gizmos (circles) and SystemParam wiring; needs browser verification after gizmo rendering.","created_at":"2026-01-22T04:26:02Z"},{"id":10,"issue_id":"moon-game-studio-q66","author":"Milky2018","text":"Added a green Mesh2d marker and dashed viewport outline in 2d_viewport_to_world to visualize input/viewport interactions; uses GizmoConfig line style switch for dashed border.","created_at":"2026-01-22T05:14:46Z"}]}
{"id":"moon-game-studio-qvz","title":"Implement WebGPU clear pass in JS host","description":"Add minimal render pass submission in host/web/host.js (clear color) and drive it from window runner.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T17:47:08.027731+08:00","created_by":"Milky2018","updated_at":"2026-01-20T17:50:51.365924+08:00","closed_at":"2026-01-20T17:50:51.365924+08:00","close_reason":"Implemented clear pass in WebGPU host"}
{"id":"moon-game-studio-r86","title":"Milestone 2 design: texture atlas + sprite animation (Bevy parity)","description":"Draft design in .private/docs/engine (Chinese). Align with Bevy texture_atlas/sprite_sheet/sprite_animation APIs. Update ROADMAP references.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T15:06:36.744651+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:06:36.744651+08:00","labels":["status:in_progress"],"comments":[{"id":12,"issue_id":"moon-game-studio-r86","author":"Milky2018","text":"Drafted .private/docs/engine/MILESTONE2_PLAN.md. Pending confirmation: host-side TextureAtlasBuilder, skipping text labels for texture_atlas, and load_folder strategy.","created_at":"2026-01-22T07:18:04Z"},{"id":13,"issue_id":"moon-game-studio-r86","author":"Milky2018","text":"Updated MILESTONE2_PLAN: Text2d moved into milestone 2, load_folder + AssetEvent aligned to Bevy. Pending confirmation: Text2d implementation path (host rasterize -\u003e sprite) vs full glyph atlas now.","created_at":"2026-01-22T07:23:30Z"},{"id":14,"issue_id":"moon-game-studio-r86","author":"Milky2018","text":"User confirmed: Text2d must be implemented now with full glyph atlas (no whole-text texture). Docs updated to reflect glyph atlas + AssetEvent + LoadedFolder.","created_at":"2026-01-22T07:28:44Z"},{"id":15,"issue_id":"moon-game-studio-r86","author":"Milky2018","text":"Added .private/docs/engine/TEXT2D.md with Bevy-aligned text pipeline and updated MILESTONE2_PLAN/ROADMAP_PHASE1 accordingly.","created_at":"2026-01-22T07:34:23Z"}]}
{"id":"moon-game-studio-r86.1","title":"State change: status → in_progress","description":"Set status to in_progress","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-22T15:06:51.917936+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:06:51.917936+08:00","dependencies":[{"issue_id":"moon-game-studio-r86.1","depends_on_id":"moon-game-studio-r86","type":"parent-child","created_at":"2026-01-22T15:06:51.918604+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-r86.2","title":"Implement Text2d pipeline (Bevy parity)","description":"Port bevy_text pipeline structures, Text2d/TextSpan components, font atlas set, glyph caching, and update_text2d_layout system.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T15:37:41.825553+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:37:41.825553+08:00","labels":["status:in_progress"],"dependencies":[{"issue_id":"moon-game-studio-r86.2","depends_on_id":"moon-game-studio-r86","type":"parent-child","created_at":"2026-01-22T15:37:41.826225+08:00","created_by":"Milky2018"}],"comments":[{"id":16,"issue_id":"moon-game-studio-r86.2","author":"Milky2018","text":"Updated text pipeline scaffolding (CosmicBuffer/span ranges, text measurement stub), added Justify::Justified + TextLayout::with_* helpers, removed self-labeled Assets methods; moon check passes with warnings.","created_at":"2026-01-22T08:34:53Z"},{"id":17,"issue_id":"moon-game-studio-r86.2","author":"Milky2018","text":"Implemented DynamicTextureAtlasBuilder + FontAtlas/FontAtlasSet scaffolding and host glyph rasterization/atlas update APIs; updated .private docs for glyph cache host signatures.","created_at":"2026-01-22T09:02:03Z"},{"id":18,"issue_id":"moon-game-studio-r86.2","author":"Milky2018","text":"Added text layout pipeline scaffolding with glyph rasterization, FontAtlasSet integration, and render2d glyph sprite submission (uv-based). Layout uses simple code-unit flow; pending Bevy parity/shaping.","created_at":"2026-01-22T09:46:56Z"},{"id":20,"issue_id":"moon-game-studio-r86.2","author":"Milky2018","text":"Drafted design for Text2d shaping/layout backend: host_text_layout JSON API implemented by browser Canvas2D; engine keeps Bevy pipeline structure. See .private/docs/engine/TEXT2D_LAYOUT_BACKEND.md (needs review/confirmation due to cosmic-text deviation).","created_at":"2026-01-22T09:57:57Z"}]}
{"id":"moon-game-studio-r86.2.1","title":"State change: status → in_progress","description":"Set status to in_progress","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-22T15:38:18.730213+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:38:18.730213+08:00","dependencies":[{"issue_id":"moon-game-studio-r86.2.1","depends_on_id":"moon-game-studio-r86.2","type":"parent-child","created_at":"2026-01-22T15:38:18.730864+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-r86.3","title":"Implement font atlas + dynamic texture atlas builder","description":"Port bevy_image dynamic_texture_atlas_builder and glyph atlas update logic; integrate with asset/image handles.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T15:37:49.219966+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:37:49.219966+08:00","dependencies":[{"issue_id":"moon-game-studio-r86.3","depends_on_id":"moon-game-studio-r86","type":"parent-child","created_at":"2026-01-22T15:37:49.220718+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-r86.4","title":"Implement asset load_folder + LoadedFolder + AssetEvent","description":"Add asset events for LoadedFolder and integrate with host async loading. Align with Bevy asset events.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T15:37:55.575864+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:37:55.575864+08:00","dependencies":[{"issue_id":"moon-game-studio-r86.4","depends_on_id":"moon-game-studio-r86","type":"parent-child","created_at":"2026-01-22T15:37:55.576563+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-r86.5","title":"Add render2d atlas UV + host APIs for glyph/textures","description":"Extend host draw_sprite with UVs, add asset_load_bytes/create_dynamic_texture/update_texture_region, and render glyph quads.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T15:38:02.381179+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:38:02.381179+08:00","dependencies":[{"issue_id":"moon-game-studio-r86.5","depends_on_id":"moon-game-studio-r86","type":"parent-child","created_at":"2026-01-22T15:38:02.381843+08:00","created_by":"Milky2018"}],"comments":[{"id":19,"issue_id":"moon-game-studio-r86.5","author":"Milky2018","text":"Added gpu_draw_sprite_uv path with UV rect support; sprite pipeline now uses UVs and uniform buffer expanded to include uv min/scale.","created_at":"2026-01-22T09:47:11Z"}]}
{"id":"moon-game-studio-r86.6","title":"Update 2d examples: sprite_sheet/sprite_animation/texture_atlas","description":"Implement examples with Text2d labels and atlas animation. Verify in browser.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T15:38:11.446349+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:38:11.446349+08:00","dependencies":[{"issue_id":"moon-game-studio-r86.6","depends_on_id":"moon-game-studio-r86","type":"parent-child","created_at":"2026-01-22T15:38:11.447001+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-rby","title":"Align ImpulseJointSet API with rapier graph/enable semantics","description":"Implement joint_graph exposure, enabled/disabled joint state, select_active_interactions, and align attached_joints signatures to rapier where feasible. Update tests accordingly.","notes":"Implemented JointEnabled + ImpulseJoint enable toggling, joint_graph snapshot, enabled filtering, and tests; islands now use enabled joints.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T16:50:37.263048+08:00","created_by":"Milky2018","updated_at":"2026-01-22T17:08:52.142058+08:00","closed_at":"2026-01-22T17:08:52.14206+08:00"}
{"id":"moon-game-studio-rdl","title":"Align joint removal wake/join dedup to rapier","description":"Update multibody joint removal to wake connected bodies and clear mappings; ensure wake/join queues dedupe and pipeline behavior matches rapier.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T11:08:28.048117+08:00","created_by":"Milky2018","updated_at":"2026-01-22T11:26:05.530194+08:00","closed_at":"2026-01-22T11:26:05.530194+08:00","close_reason":"done"}
{"id":"moon-game-studio-si5","title":"L2 examples: 2d_viewport_to_world + pixel_grid_snap","description":"Design + implement 2d_viewport_to_world and pixel_grid_snap examples. Update .private/docs with design before implementation. Keep parity with Bevy; confirm deviations.","notes":"Fix: create window/GPU before startup so startup systems can read window size (viewport_to_world visibility). Added note in HOST_INTERFACE.md.","status":"in_progress","priority":2,"issue_type":"task","assignee":"Milky2018","owner":"842376130@qq.com","created_at":"2026-01-21T20:33:01.941538+08:00","created_by":"Milky2018","updated_at":"2026-01-22T08:57:10.434894+08:00"}
{"id":"moon-game-studio-svl","title":"Fix web menu reload + drop wasm backend config","description":"Allow reload button after example run; remove wasm backend configuration from moon.pkg.json; update .private docs to mention wasm-gc only.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T12:32:55.714351+08:00","created_by":"Milky2018","updated_at":"2026-01-21T12:33:05.730947+08:00","closed_at":"2026-01-21T12:33:05.730947+08:00","close_reason":"Closed"}
{"id":"moon-game-studio-ukx","title":"Verify mesh2d example in browser","description":"Run mesh2d example in browser (WASM-GC) and confirm rectangle renders with correct color/scale.","status":"open","priority":3,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T14:02:13.442604+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:02:13.442604+08:00"}
{"id":"moon-game-studio-xux","title":"Fix mgstudio_physics testbed blackbox wasm compile error in moon test","description":"Investigate testbed blackbox wasm compile error during moon test; fix or adjust testbed package/tests.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T19:45:48.966186+08:00","created_by":"Milky2018","updated_at":"2026-01-21T19:46:32.122004+08:00","labels":["status:done"]}
{"id":"moon-game-studio-xux.1","title":"State change: status → done","description":"Set status to done","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-21T20:20:08.446144+08:00","created_by":"Milky2018","updated_at":"2026-01-21T20:20:08.446144+08:00","dependencies":[{"issue_id":"moon-game-studio-xux.1","depends_on_id":"moon-game-studio-xux","type":"parent-child","created_at":"2026-01-21T20:20:08.446672+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-xxm","title":"Align ImpulseJointSet/IslandManager graph semantics with rapier","description":"Refine impulse joint graph handling, handle validity, and island mappings to match rapier dynamics semantics; add coverage for joint set behaviors.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T09:29:59.919965+08:00","created_by":"Milky2018","updated_at":"2026-01-22T09:29:59.919965+08:00","labels":["status:done"]}
{"id":"moon-game-studio-xxm.1","title":"State change: status → in_progress","description":"Set status to in_progress\n\nReason: Implementing rapier-aligned impulse joint/island behavior","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-22T09:30:19.393148+08:00","created_by":"Milky2018","updated_at":"2026-01-22T09:30:19.393148+08:00","dependencies":[{"issue_id":"moon-game-studio-xxm.1","depends_on_id":"moon-game-studio-xxm","type":"parent-child","created_at":"2026-01-22T09:30:19.393828+08:00","created_by":"Milky2018"}]}
{"id":"moon-game-studio-xxm.2","title":"State change: status → done","description":"Changed status from in_progress to done\n\nReason: Implemented rapier-aligned impulse joint set behavior and tests","status":"open","priority":4,"issue_type":"event","created_at":"2026-01-22T09:30:59.389933+08:00","created_by":"Milky2018","updated_at":"2026-01-22T09:30:59.389933+08:00","dependencies":[{"issue_id":"moon-game-studio-xxm.2","depends_on_id":"moon-game-studio-xxm","type":"parent-child","created_at":"2026-01-22T09:30:59.390633+08:00","created_by":"Milky2018"}]}
