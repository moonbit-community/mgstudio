// Copyright 2025 International Digital Economy Academy
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

///|
/// Built-in WebGPU shaders.
///
/// The web runtime should be self-contained for release packaging.

///|
const SPRITE_WGSL : String = "// Copyright 2025 International Digital Economy Academy\n//\n// Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nstruct VertexOut {\n  @builtin(position) position : vec4<f32>,\n  @location(0) uv : vec2<f32>,\n  @location(1) color : vec4<f32>,\n};\n\nstruct Globals {\n  view : vec4<f32>,\n  ndc_scale : vec4<f32>,\n};\n\nstruct InstanceData {\n  model : vec4<f32>,\n  scale : vec4<f32>,\n  color : vec4<f32>,\n  uv : vec4<f32>,\n};\n\n@group(0) @binding(0) var samp : sampler;\n@group(0) @binding(1) var tex : texture_2d<f32>;\n@group(1) @binding(0) var<uniform> u_globals : Globals;\n@group(1) @binding(1) var<storage, read> instances : array<InstanceData>;\n\n@vertex\nfn vs_main(\n  @location(0) position : vec2<f32>,\n  @location(1) uv : vec2<f32>,\n  @builtin(instance_index) instance_index : u32,\n) -> VertexOut {\n  var out : VertexOut;\n  let inst = instances[instance_index];\n  let cosv = inst.model.z;\n  let sinv = inst.model.w;\n  let scaled = vec2<f32>(\n    position.x * inst.scale.x,\n    position.y * inst.scale.y\n  );\n  let rotated = vec2<f32>(\n    scaled.x * cosv - scaled.y * sinv,\n    scaled.x * sinv + scaled.y * cosv\n  );\n  let translated = rotated + inst.model.xy;\n  let cam_cos = u_globals.view.z;\n  let cam_sin = u_globals.view.w;\n  let rel = translated - u_globals.view.xy;\n  let view_pos = vec2<f32>(\n    rel.x * cam_cos - rel.y * cam_sin,\n    rel.x * cam_sin + rel.y * cam_cos\n  );\n  let ndc = vec2<f32>(\n    view_pos.x * u_globals.ndc_scale.x,\n    view_pos.y * u_globals.ndc_scale.y\n  );\n  out.position = vec4<f32>(ndc, 0.0, 1.0);\n  out.uv = inst.uv.xy + uv * inst.uv.zw;\n  out.color = inst.color;\n  return out;\n}\n\n@fragment\nfn fs_main(\n  @location(0) uv : vec2<f32>,\n  @location(1) color : vec4<f32>,\n) -> @location(0) vec4<f32> {\n  return textureSample(tex, samp, uv) * color;\n}\n"

///|
const MESH_WGSL : String = "// Copyright 2025 International Digital Economy Academy\n//\n// Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nstruct VertexOut {\n  @builtin(position) position : vec4<f32>,\n};\n\nstruct TransformData {\n  model : vec4<f32>,\n  view : vec4<f32>,\n  scale : vec4<f32>,\n  color : vec4<f32>,\n  uv : vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> u_transform : TransformData;\n\n@vertex\nfn vs_main(@location(0) position : vec2<f32>) -> VertexOut {\n  var out : VertexOut;\n  let cosv = u_transform.model.z;\n  let sinv = u_transform.model.w;\n  let scaled = vec2<f32>(\n    position.x * u_transform.scale.z,\n    position.y * u_transform.scale.w\n  );\n  let rotated = vec2<f32>(\n    scaled.x * cosv - scaled.y * sinv,\n    scaled.x * sinv + scaled.y * cosv\n  );\n  let translated = rotated + u_transform.model.xy;\n  let cam_cos = u_transform.view.z;\n  let cam_sin = u_transform.view.w;\n  let rel = translated - u_transform.view.xy;\n  let view_pos = vec2<f32>(\n    rel.x * cam_cos - rel.y * cam_sin,\n    rel.x * cam_sin + rel.y * cam_cos\n  );\n  let ndc = vec2<f32>(\n    view_pos.x * u_transform.scale.x,\n    view_pos.y * u_transform.scale.y\n  );\n  out.position = vec4<f32>(ndc, 0.0, 1.0);\n  return out;\n}\n\n@fragment\nfn fs_main() -> @location(0) vec4<f32> {\n  return u_transform.color;\n}\n"

///|
const GIZMO_LINES_WGSL : String = "// Copyright 2025 International Digital Economy Academy\n//\n// Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nstruct VertexOut {\n  @builtin(position) position : vec4<f32>,\n  @location(0) color : vec4<f32>,\n};\n\n@vertex\nfn vs_main(\n  @location(0) position : vec2<f32>,\n  @location(1) color : vec4<f32>,\n) -> VertexOut {\n  var out : VertexOut;\n  out.position = vec4<f32>(position, 0.0, 1.0);\n  out.color = color;\n  return out;\n}\n\n@fragment\nfn fs_main(in : VertexOut) -> @location(0) vec4<f32> {\n  return in.color;\n}\n"
